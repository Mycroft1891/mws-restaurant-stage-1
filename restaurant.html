<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <meta name="theme-color" content="#333">
  <link rel="stylesheet" src="//normalize-css.googlecode.com/svn/trunk/normalize.css" />
  <link rel="manifest" href="manifest.json">
  <link rel="shortcut icon" href="favicon.ico">
  <link rel="apple-touch-icon" sizes="57x57" href="/icon/apple-icon-57x57.png">
  <link rel="apple-touch-icon" sizes="60x60" href="/icon/apple-icon-60x60.png">
  <link rel="apple-touch-icon" sizes="72x72" href="/icon/apple-icon-72x72.png">
  <link rel="apple-touch-icon" sizes="76x76" href="/icon/apple-icon-76x76.png">
  <link rel="apple-touch-icon" sizes="114x114" href="/icon/apple-icon-114x114.png">
  <link rel="apple-touch-icon" sizes="120x120" href="/icon/apple-icon-120x120.png">
  <link rel="apple-touch-icon" sizes="144x144" href="/icon/apple-icon-144x144.png">
  <link rel="apple-touch-icon" sizes="152x152" href="/icon/apple-icon-152x152.png">
  <link rel="apple-touch-icon" sizes="180x180" href="/icon/apple-icon-180x180.png">
  <link rel="icon" type="image/png" sizes="192x192"  href="/icon/android-icon-192x192.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/icon/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="96x96" href="/icon/favicon-96x96.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/icon/favicon-16x16.png">
  <title>Restaurant Info</title>
  <style media="screen">
    @charset "utf-8";body,p,td,th{font-family:Arial,Helvetica,sans-serif;font-size:10pt;color:#333;line-height:1.5}body{background-color:#fdfdfd;margin:0;position:relative}li,ul{font-family:Arial,Helvetica,sans-serif;font-size:10pt;color:#333}a{color:orange;text-decoration:none}a:focus,a:hover{color:#3397db;text-decoration:none}a img{border:none 0 #fff}h1,h2,h3,h4,h5,h6{font-family:Arial,Helvetica,sans-serif;margin:0 0 20px}article,aside,canvas,details,figcaption,figure,footer,header,hgroup,menu,nav,section{display:block}#maincontent{background-color:#f3f3f3;min-height:100%}#footer{background-color:#444;color:#b1b1b1;font-size:8pt;letter-spacing:1px;padding:1.5rem 0;text-align:center;text-transform:uppercase}nav{width:100%;height:3rem;background-color:#252831;text-align:center;padding-top:1rem}nav h1{margin:auto}nav h1 a{color:#fff;font-size:14pt;font-weight:200;letter-spacing:10px;text-transform:uppercase}#breadcrumb-nav{padding:10px 40px 16px;background-color:#eee;width:calc(50% - 80px);height:1.5rem;text-align:left}#breadcrumb{padding:0;list-style:none;font-size:17px;margin:0}#breadcrumb li{display:inline}#breadcrumb li+li:before{padding:8px;color:#000;content:"/\00a0"}#breadcrumb li a{color:#006cc9;text-decoration:none}#breadcrumb li a:hover{color:#01447e;text-decoration:underline}#map{height:60vh;width:100%;background-color:#ccc}#map-placeholder{background-image:url(/img/map-image.png);background-size:cover;padding:38vh 0;font-size:2rem;color:#2f4f4f}.inside header{position:fixed;top:0;width:100%;z-index:1000}.inside #map-container{height:calc(100% - 4rem);position:fixed;right:0;top:4rem;width:50%}.inside #map{background-color:#ccc;height:100%;width:100%}.inside #footer{bottom:0;position:absolute;width:50%}#restaurant-name{color:#aa5a00;font-family:Arial,sans-serif;font-size:20pt;font-weight:200;letter-spacing:0;margin:4rem 0 1rem;text-transform:uppercase;line-height:1.1}#restaurant-favorite{color:#fff;padding:.5rem 1rem}#restaurant-img{width:100%}#restaurant-address{font-size:12pt;margin:10px 0}#restaurant-cuisine{background-color:#333;color:#ddd;font-size:12pt;font-weight:300;letter-spacing:10px;margin:0 0 20px;padding:2px 0;text-align:center;text-transform:uppercase;width:100%}#restaurant-container,#reviews-container{border-bottom:1px solid #d9d9d9;border-top:1px solid #fff;padding:4rem 2rem 1rem;width:calc(50% - 4rem)}#reviews-container{padding:2rem 1rem 4rem 1rem}#reviews-container h2{color:#aa5a00;font-size:24pt;font-weight:300;letter-spacing:-1px;padding-bottom:1pt}#reviews-list{margin:0 0 5rem;padding:0}#reviews-list li{background-color:#fff;border-top-left-radius:2rem;border-bottom-right-radius:2rem;display:block;list-style-type:none;margin:0 0 30px;overflow:hidden;position:relative;width:100%}#reviews-list li p{margin-top:10px;margin-bottom:10px}#restaurant-hours td{color:#666}.review-name{color:#fff}.review-date{color:#b9b9b9;text-align:right}.review-date,.review-name{background-color:#333;display:inline-block;width:calc(100%/2 - 2rem);padding:1rem;margin:0!important}.review-rating{display:inline-block;border:1px solid #a56900;border-radius:.2rem;background-color:#a56900;color:#fff;padding:.2rem 1rem;margin-left:1.5rem}.review-comments{padding:0 1.5rem}#review-form h3{border:1px solid;border-color:#b20000;border-radius:.2rem;padding:.5rem;color:#b20000}#form-comment,#form-name{width:100%;line-height:1.5rem;margin-bottom:.5rem}#form-submit{border:none;color:#fff;background-color:#a56900;padding:.5rem 1rem;margin-bottom:1rem}label{display:block}@media (max-width:499px){nav h1 a{letter-spacing:.3rem}#restaurant-container,#reviews-container{width:90%}}@media (min-width:500px) and (max-width:749px){#restaurant-container,#reviews-container{width:70%}}@media (max-width:749px){#breadcrumb-nav{width:100%}#restaurant-name{margin:2rem 0 1rem}#restaurant-container,#reviews-container{margin:auto;padding:4rem 1rem 1rem}#reviews-container{padding:2rem 1rem 4rem 1rem}.inside #map-container{position:relative;height:calc(100vh - 7rem);margin-top:3rem;width:100%}#map-placeholder{position:relative;height:calc(100vh - (50vh + 7rem));padding:25vh 0;margin-top:3rem;width:100%}.inside #footer{width:100%}}@media (min-width:750px){#map-placeholder{height:calc(100% - 4rem);position:fixed;right:0;top:4rem;width:50%}}
  </style>
</head>

<body class="inside">
  <!-- Custom message when JS is disabled -->
  <noscript>
    You need to enable JavaScript to run this app.
  </noscript>

  <header>
    <nav>
      <h1><a href="/">Restaurant Reviews</a></h1>
    </nav>
    <nav aria-label="Breadcrumb" id="breadcrumb-nav">
      <ul id="breadcrumb" >
        <li><a href="/">Home</a></li>
      </ul>
    </nav>
  </header><!-- End header -->

  <main id="maincontent">
    <section id="map-container">
      <div id="map-placeholder" onclick="showMap(this)">
        <center><h2>Click for Live Map</h2></center>
      </div>
      <div id="map" role="application" style="display:none"></div>
    </section><!-- End map -->
    <section id="restaurant-container">
      <h2 id="restaurant-name"></h2>
      <button onclick="toggleFavorite(this)" id="restaurant-favorite"></button>
      <img id="restaurant-img">
      <p id="restaurant-cuisine"></p>
      <p id="restaurant-address"></p>
      <table id="restaurant-hours"></table>
    </section><!-- end restaurant -->
    <section id="reviews-container">
      <section>
        <h2>Write Review</h2>
        <form id="review-form" onsubmit="handleForm(this); return false;">
          <h3 hidden="true" id="form-alert">Please fill the entire form</h3>
          <label for="rating">Rating</label>
          <input type="radio" name="rating" value="1">1</input>
          <input type="radio" name="rating" value="2">2</input>
          <input type="radio" name="rating" value="3">3</input>
          <input type="radio" name="rating" value="4">4</input>
          <label for="name">Name</label>
          <input type="text" name="name" id="form-name">
          <label for="comment">Comment</label>
          <input type="text" name="comment" id="form-comment">
          <input type="submit" value="Post Review" id="form-submit">
        </form>
      </section>
      <ul id="reviews-list"></ul>
    </section><!-- End reviews -->
  </main><!-- End main -->

  <footer id="footer">
    Copyright (c) 2017 <a href="/"><strong>Restaurant Reviews</strong></a> All Rights Reserved.
  </footer>

  <script>
    "serviceWorker"in navigator&&navigator.serviceWorker.register("sw.js").then(e=>console.log("Service Worker is installed: ",e.scope)).catch(e=>console.log("Failed to register Service Worker: ",e));const data={version:1,dbname:"EXAMPLE_DB",store:"products"};class IDB{static supported(){return!!window.indexedDB}static getItems(e){var t=window.indexedDB.open(data.dbname,data.version);t.onsuccess=function(t){var r=t.target.result.transaction(data.store,"readwrite").objectStore(data.store).getAll();r.onsuccess=function(){e(r.result)}},t.onupgradeneeded=function(e){e.target.result.createObjectStore(data.store,{keyPath:"id"})}}static saveRecord(e){var t=window.indexedDB.open(data.dbname,data.version);t.onsuccess=function(t){t.target.result.transaction(data.store,"readwrite").objectStore(data.store).add(e)},t.onerror=function(e){console.log("[onerror]",t.error)},t.onupgradeneeded=function(e){e.target.result.createObjectStore(data.store,{keyPath:"id"})}}static updateRecord(e,t){console.log("ID: ",t),console.log("Adding Review: ",e);var r=window.indexedDB.open(data.dbname,data.version);r.onsuccess=function(t){t.target.result.transaction(data.store,"readwrite").objectStore(data.store).put(e)},r.onerror=function(e){console.log("[onerror]",r.error)},r.onupgradeneeded=function(e){e.target.result.createObjectStore(data.store,{keyPath:"id"})}}}class DBHelper{static get DATABASE_URL(){return"http://localhost:1337/restaurants"}static get REVIEWS_URL(){return"http://localhost:1337/reviews/?restaurant_id="}static fetchRestaurants(e){IDB.getItems(t=>{if(t.length>0)return e(null,t);fetch(DBHelper.DATABASE_URL).then(e=>e.json()).catch(t=>e(t.message,null)).then(t=>{t.forEach(e=>IDB.saveRecord(e)),DBHelper.fetchRestaurantReviews(t),e(null,t)})})}static fetchRestaurantReviews(e){e.map(e=>{fetch(DBHelper.REVIEWS_URL+e.id).then(e=>e.json()).then(t=>{e.reviews=t,IDB.updateRecord(e,e.id)})})}static fetchRestaurantById(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)return t(r,null);const a=n.find(t=>t.id==e);if(a)return t(null,a);t("Restaurant does not exist",null)})}static fetchRestaurantByCuisine(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)return t(r,null);const a=n.filter(t=>t.cuisine_type==e);t(null,a)})}static fetchRestaurantByNeighborhood(e,t){DBHelper.fetchRestaurants((r,n)=>{if(r)return t(r,null);const a=n.filter(t=>t.neighborhood==e);t(null,a)})}static fetchRestaurantByCuisineAndNeighborhood(e,t,r){DBHelper.fetchRestaurants((n,a)=>{if(n)return r(n,null);let s=a;"all"!=e&&(s=s.filter(t=>t.cuisine_type==e)),"all"!=t&&(s=s.filter(e=>e.neighborhood==t)),r(null,s)})}static fetchNeighborhoods(e){DBHelper.fetchRestaurants((t,r)=>{if(t)return e(t,null);const n=r.map((e,t)=>r[t].neighborhood),a=n.filter((e,t)=>n.indexOf(e)==t);e(null,a)})}static fetchCuisines(e){DBHelper.fetchRestaurants((t,r)=>{if(t)return e(t,null);const n=r.map((e,t)=>r[t].cuisine_type),a=n.filter((e,t)=>n.indexOf(e)==t);return e(null,a)})}static urlForRestaurant(e){return`./restaurant.html?id=${e.id}`}static imageUrlForRestaurant(e){return`/img/prod/${e}`}static mapMarkerForRestaurant(e,t){return new google.maps.Marker({position:e.latlng,title:e.name,url:DBHelper.urlForRestaurant(e),map:t,animation:google.maps.Animation.DROP})}}let restaurant;var map;showMap=(e=>{const t=document.getElementById("map");e.style.display="none",t.style.display="block"}),window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{e?console.error(e):(self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),self.map.addListener("idle",()=>{document.getElementsByTagName("iframe")[0].title=t.name}),fillBreadcrumb(),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map))})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(t,(t,r)=>{self.restaurant=r,r?(fillRestaurantHTML(),e(null,r)):console.error(t)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name;const t=document.getElementById("restaurant-favorite");t.innerHTML=e.is_favorite?"Saved as Favorite":"Save as Favorite",t.style.backgroundColor=e.is_favorite?"#a56900":"#708090",document.getElementById("restaurant-address").innerHTML=e.address;const r=document.getElementById("restaurant-img");r.className="restaurant-img";let n=DBHelper.imageUrlForRestaurant(e.photograph);r.src=n+"-small.jpg",r.srcset=`\n    ${n+"-small.jpg"},\n    ${n+"-medium.jpg"} 1.5x,\n    ${n+"-large.jpg"} 2x,\n  `,r.alt=`Restaurant ${e.name}`,document.getElementById("restaurant-cuisine").innerHTML=e.cuisine_type,e.operating_hours&&fillRestaurantHoursHTML(),fillReviewsHTML()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let r in e){const n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);const s=document.createElement("td");s.innerHTML=e[r],n.appendChild(s),t.appendChild(n)}}),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),r=document.createElement("h2");if(r.innerHTML="Reviews",t.appendChild(r),!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}const n=document.getElementById("reviews-list");e.reverse().forEach(e=>{n.appendChild(createReviewHTML(e))}),t.appendChild(n)}),createReviewHTML=(e=>{const t=document.createElement("li"),r=document.createElement("p");r.classList="review-name",r.innerHTML=e.name,t.appendChild(r);const n=document.createElement("p");n.classList="review-date",n.innerHTML=formatDate(e.createdAt||new Date),t.appendChild(n);const a=document.createElement("p");a.classList="review-rating",a.innerHTML=`Rating: ${e.rating}`,t.appendChild(a);const s=document.createElement("p");return s.classList="review-comments",s.innerHTML=e.comments,t.appendChild(s),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,r.setAttribute("aria-current","page"),t.appendChild(r)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}),toggleFavorite=((e,t=self.restaurant)=>{t.is_favorite=!t.is_favorite,e.style.backgroundColor=t.is_favorite?"#a56900":"#708090",e.innerHTML=t.is_favorite?"Saved as Favorite":"Save as Favorite",IDB.updateRecord(t),fetch(`http://localhost:1337/restaurants/${t.id}/?is_favorite=${t.is_favorite}`)});const form_alert=document.getElementById("form-alert");let restaurant_id=window.location.href.split("=")[1],pending_reviews=[];window.addEventListener("online",e=>{0!=pending_reviews.length&&pending_reviews.forEach(e=>postReview(e))}),window.addEventListener("offline",e=>{console.log("Currently offline")}),handleForm=(e=>{if([name,rating,comment]=[e.name.value,e.rating.value,e.comment.value],!name||!rating||!comment)return void(form_alert.hidden=!1);let t={restaurant_id:restaurant_id,name:name,rating:rating,comments:comment};return window.navigator.onLine?postReview(t):pending_reviews.push(t),document.getElementById("reviews-list").prepend(createReviewHTML(t)),form_alert.hidden=!0,e.reset(),!1}),postReview=(e=>{self.restaurant.reviews.push(e),IDB.updateRecord(self.restaurant),fetch("http://localhost:1337/reviews/",{method:"post",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(e)}).then(e=>e.json()).then(e=>console.log(e))}),formatDate=(e=>{const t=e?new Date(e):new Date;var r=t.getDate(),n=t.getMonth(),a=t.getFullYear();return`${["January","February","March","April","May","June","July","August","September","October","November","December"][n]} ${r}, ${a}`});
  </script>
  <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCtFvrhtulfSH_7R90jFKRMCCWDfmzFTYU&libraries=places&callback=initMap"></script>
</body>

</html>
